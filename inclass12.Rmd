---
title: "Applied Statistical Programming - Projects"
author: Berta Diaz, Zion Little, Alma Velazquez
date: "2/23/2022"
header-includes:
   - \usepackage{amsmath}
   - \usepackage{geometry}
   - \usepackage{hyperref}
   - \usepackage{setspace}
   - \usepackage{hyperref}
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\textbf{Write the R code to answer the following questions. Write the code, and then show what the computer returns when that code is run. Thoroughly comment your solutions.}

You have until the beginning of class 2/28 at 10:00am to complete the assignment below. You may use R, but not any online R documentation. Submit the Rmarkdown and the knitted PDF to Canvas. Have one group member submit the activity with all group members listed at the top.

\section*{Project Management}

In this exercise, you will plot a Twitter user's activity for a single day distinguishing between their novel content and their retweets. You will load a data set, modify it, and generate figures in a project environment. Download the \texttt{Tweets.csv} file from Canvas, and complete the following tasks in your project environment.

\begin{enumerate}
  \item Subset the data to the user \texttt{a\_silberberg} for tweets occurring on November 4, 2015.
  \item Write the subset data as a CSV file into a \texttt{Data} sub-folder of your project.
  \item Generate a \texttt{plot()} where the Y-axis is a count of Twitter activity and the X-axis is the time of day the activity took place. Use the \texttt{IsRetweet} variable to distinguish whether the activity was a retweet or new content generated by the user. Your plot must have a title, labeled axes, and a legend for the two types of Twitter activity ("Tweet" versus "Retweet").
  \item Write the plot as a PDF to a \texttt{Figures} sub-folder of your project.
\end{enumerate}

You will need to generate count variables to make this plot. You will also need to use the \texttt{lubridate} package to parse time from the full date-time stamp. Assuming you have already subsetted the data to only focus on the user \texttt{a\_silberberg}, you can create a new variable in the data for the time with the following code. You will also need to wrap \texttt{newtime} in a \texttt{as.POSIXct()} statement so R knows how to handle the time data.

### Read in data, explore variables
```{r}
tweets <- read.csv("Tweets.csv")
head(tweets$ScreenName)
head(tweets$CreatedTime)

length(unique(tweets$ScreenName))

only_a_Silberberg <- tweets[tweets$ScreenName == "a_silberberg", ]



```

### Prepare dates
```{r}
# Remove eval=FALSE to have this code block run.
library(lubridate)
# Assume the "only_a_Silberberg" subsetted data already exists.
only_a_Silberberg$dates <- as.POSIXct(only_a_Silberberg$CreatedTime, format = "%Y-%m-%d %H:%M:%S")
# Extra the day from the full time stamp
only_a_Silberberg$days <- format(only_a_Silberberg$dates, format = "%Y-%m-%d")
# Subset the data again so only tweets on November 4 are included.
newData <- only_a_Silberberg[which(only_a_Silberberg$days == "2015-11-04"),]
# Make a new variable in the data that is only the time of the tweet, not the day
newData$newtime <- format(as.POSIXct(newData$CreatedTime, format = "%Y-%m-%d %H:%M:%S"), 
                          format = "%H:%M:%S")
```

### Write to CSV
```{r}
write.csv(newData, "Data/a_silberg_110415.csv")
```

### Creating count variables (unused)
```{r}
# str(newData$IsRetweet)
# 
# count_var <- function(i){
#   return(nrow(newData[newData$hour_tweeted == i,]))
# }
# 
# hours <- c(0:24)
# counts <- as.vector(unlist(lapply(hours, count_var)))
# 
# newData <- merge(newData, cbind(hours, counts), by.x = "hour_tweeted", by.y = "hours")

```

### Plots and saving
```{r}
newData$hour_tweeted <- hour(newData$dates)
labs <- c(paste0(c(12, 1:11), "AM"),paste0(c(12, 1:11), "PM"))

pdf("plots/a_silberberg110415.pdf")
hist(x=newData[newData$IsRetweet==1,]$hour_tweeted, col=rgb(1,0,0,.3), border=NA,xaxt="none", main = paste(max(newData$ScreenName), "tweets on November 4, 2015"), breaks=23, xlab="Hour")
hist(x=newData[newData$IsRetweet==0,]$hour_tweeted, col=rgb(0,0,1,.3), border=NA, add=TRUE,xaxt="none", breaks=23)
axis(side=1, at=0:23, labels=labs, cex.axis=0.75)
legend("topright",box.lwd=0,title="Tweet Type",c("Retweet", "Original Tweet"), fill = c(rgb(1,0,0,.3), rgb(0,0,1,.3)))
dev.off()
```

### Testing hist() outputs
```{r}
nrow(newData[which(newData$hour_tweeted<=5 & newData$IsRetweet == 0), ])
```
